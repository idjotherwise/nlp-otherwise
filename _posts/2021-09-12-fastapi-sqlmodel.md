---
keywords: fastai
description: "Using alembic for migrations and deploying to Heroku"
title: "Making a fastapi app with sqlmodel"
toc: true
branch: master
badges: false
comments: false
author: Ifan Johnston
categories: [web-dev, fastapi]
nb_path: _notebooks/2021-09-12-fastapi-sqlmodel.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-09-12-fastapi-sqlmodel.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will be deploying a quick fastapi app to Heroku, using sqlmodel to handle a connection to the database and alembic for migrations. Let's get straight into it!</p>
<p>To see the full code, see the <a href="https://github.com/idjotherwise/fastbook-blog">git repo</a>.</p>
<h1 id="Package-requirements">Package requirements<a class="anchor-link" href="#Package-requirements"> </a></h1><p>We will start by installing all the packages we will need into a virtual environment.</p>
<div class="highlight"><pre><span></span>python3 -m venv fastenv
<span class="nb">source</span> fastenv/bin/activate
pip install fastapi sqlmodel uvicorn Jinja2 aiofiles
</pre></div>
<p>Those packages are enough to get off the ground for local development. We will be using an <code>sqlite</code> database for local development, but when we deploy to Heroku we'll use <code>Postgres</code> so let's install some additional things we need for later.</p>
<div class="highlight"><pre><span></span>pip install psycopg2 alembic gunicorn
</pre></div>
<p>We also installed <code>alembic</code> for database migrations, and <code>gunicorn</code> to use as a production server. The <code>psycopg2</code> package allows <code>sqlmodel</code> (which uses <code>SQLAlchemy</code> underneath) to talk to <code>Postgres</code> databases.</p>
<p>Those are all the packages we are going to need, so let's save them to a <code>requirements.txt</code> file before we forget.</p>
<div class="highlight"><pre><span></span>pip freeze &gt; requirements.txt
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Fastapi-app">Fastapi app<a class="anchor-link" href="#Fastapi-app"> </a></h1><p>Start by making the files <code>main.py</code> and <code>__init__.py</code> inside a directory called <code>app</code>, so that the file structure looks like this:</p>

<pre><code>.
├── app
│   ├── __init__.py
│   ├── main.py
├── bookenv
│   ├── bin
│   ├── include
│   ├── lib
│   └── pyvenv.cfg
└── requirements.txt</code></pre>
<h2 id="Main.py">Main.py<a class="anchor-link" href="#Main.py"> </a></h2><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">import</span> <span class="nn">uvicorn</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home_page</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello!&quot;</span><span class="p">}</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;app.main:app&#39;</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<p>Running this with <code>python -m app.main</code> should start up a server on port <code>8000</code> on your <code>localhost</code>, so going to <code>127.0.0.1:8000</code> should show you the message</p>

<pre><code>{"message": "Hello!"}</code></pre>
<h2 id="Making-it-look-nice">Making it look nice<a class="anchor-link" href="#Making-it-look-nice"> </a></h2><p>Before setting up our database and models, let's make the first page look nice using Jinja templates.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">import</span> <span class="nn">uvicorn</span>

<span class="c1">## new</span>
<span class="kn">from</span> <span class="nn">starlette.staticfiles</span> <span class="kn">import</span> <span class="n">StaticFiles</span>
<span class="kn">from</span> <span class="nn">starlette.templating</span> <span class="kn">import</span> <span class="n">Jinja2Templates</span>
<span class="kn">from</span> <span class="nn">starlette.requests</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="n">templates</span> <span class="o">=</span> <span class="n">Jinja2Templates</span><span class="p">(</span><span class="s1">&#39;app/templates&#39;</span><span class="p">)</span>
<span class="c1">######</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1">## new</span>
<span class="k">def</span> <span class="nf">configure</span><span class="p">():</span>
    <span class="n">app</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/static&#39;</span><span class="p">,</span> <span class="n">StaticFiles</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;app/static&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
<span class="c1">######</span>


<span class="c1">## changed</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">templates</span><span class="o">.</span><span class="n">TemplateResponse</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
<span class="c1">###</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">configure</span><span class="p">()</span> <span class="c1">## new</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;app.main:app&#39;</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">configure</span><span class="p">()</span> <span class="c1">## new</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After importing the required packages, we set up the templates with <code>Jinja2Templates('app/templates')</code> and also mount the static files so that <code>fastapi</code> can find them with <code>app.mount('/static', StaticFiles(directory='app/static', name='static')</code>, so we need to make 2 directories:</p>
<div class="highlight"><pre><span></span>mkdir app/static
mkdir app/templates
</pre></div>
<p>Inside templates, we'll create the following <code>index.html</code> file,</p>

<pre><code>&lt;!DOCTYPE html&gt;

&lt;html lang="en-us"&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta name="description" content="A website showcasing fastapi and sqlmodel"&gt;
    &lt;meta name="author" content="idjotherwise"&gt;

    &lt;title&gt;Fastsqlmodel showcase&lt;/title&gt;

    &lt;link href="//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;h1&gt;
        A super stylish home page
    &lt;/h1&gt;
    &lt;p&gt;
        Really interesting content, full of buzzwords like AI and MACHINE LEARNING!
    &lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Now we can run the app to check that things are working so far,</p>
<div class="highlight"><pre><span></span>python -m main.app
</pre></div>
<p>If everything has gone well, after opening up <code>localhost:8000</code>, you should be greeted with</p>
<p><img src="/nlp-otherwise/images/copied_from_nb/../images/screenshot_1.png" alt="You should be greeted with this lovely webpage"></p>
<p>We'll refactor the <code>jinja</code> templates later, but that will do for now.</p>
<p>Next we'll set up some database stuff, including some models to hold our data.</p>
<h2 id="Database:-sqlmodel">Database: sqlmodel<a class="anchor-link" href="#Database:-sqlmodel"> </a></h2><p>In a new file called <code>database.py</code>, we'll set up the database engine and session handler.</p>
<div class="highlight"><pre><span></span><span class="c1"># app/database.py</span>

<span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">SQLModel</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Session</span>

<span class="kn">from</span> <span class="nn">.settings</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="n">connect_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">database_url</span><span class="p">),</span> <span class="n">connect_args</span><span class="o">=</span><span class="n">connect_args</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">create_db_and_tables</span><span class="p">():</span>
    <span class="n">SQLModel</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_session</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>
</pre></div>
<p>and in the file <code>settings.py</code> we'll define the <code>DATABASE_URL</code>,</p>
<div class="highlight"><pre><span></span><span class="c1"># app/settings.py</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseSettings</span>

<span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">database_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sqlite:///database.db&#39;</span>
</pre></div>
<p>This may seem uncessarily complex, but it will make things easier later. When your class <code>Settings</code> inherits from <code>BaseSettings</code>, it will first try to get the attributes from your environment but if it doesn't find anything it will set it to the default you've given. So in our case (assuming you haven't set <code>DATABASE_URL</code> to anything else in your terminal) it will simply be the <code>sqlite</code> database url. On Heroku, environment variables like <code>DATABASE_URL</code> are set automatically (if you have installed a <code>Postgres</code> add-on).</p>
<p>Before we actually create the database, we should create a model that will go into the database. In a new file <code>models.py</code>,</p>
<div class="highlight"><pre><span></span><span class="c1"># app/models.py</span>

<span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">SQLModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>


<span class="k">class</span> <span class="nc">BookBase</span><span class="p">(</span><span class="n">SQLModel</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">BookBase</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<p>In <code>sqlmodel</code>, models can be treated as both <code>Pydantic</code> models and <code>SQLAlchemy</code> models. That's all it takes to create the table called <code>Book</code> in the database. Now let's actually create the table, we add some code to <code>main.py</code></p>
<div class="highlight"><pre><span></span><span class="c1"># app/main.py</span>

<span class="c1"># changed</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Depends</span>
<span class="c1"># -------</span>
<span class="kn">import</span> <span class="nn">uvicorn</span>

<span class="kn">from</span> <span class="nn">starlette.staticfiles</span> <span class="kn">import</span> <span class="n">StaticFiles</span>
<span class="kn">from</span> <span class="nn">starlette.templating</span> <span class="kn">import</span> <span class="n">Jinja2Templates</span>
<span class="kn">from</span> <span class="nn">starlette.requests</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="c1"># new ---</span>
<span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">select</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">create_db_and_tables</span><span class="p">,</span> <span class="n">get_session</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>
<span class="c1"># ------</span>

<span class="n">templates</span> <span class="o">=</span> <span class="n">Jinja2Templates</span><span class="p">(</span><span class="s1">&#39;app/templates&#39;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">configure</span><span class="p">():</span>
    <span class="c1"># new ---</span>
    <span class="n">create_db_and_tables</span><span class="p">()</span>
    <span class="c1"># -------</span>
    <span class="n">app</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/static&#39;</span><span class="p">,</span> <span class="n">StaticFiles</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;app/static&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>

<span class="c1"># changed</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">templates</span><span class="o">.</span><span class="n">TemplateResponse</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
<span class="c1"># -------</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">configure</span><span class="p">()</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;app.main:app&#39;</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">configure</span><span class="p">()</span>
</pre></div>
<p>Finally add the following bit of code to the <code>index.html</code> file (see the <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/">Jinja documentation</a> for more information),</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en-us&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;A website showcasing fastapi and sqlmodel&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;idjotherwise&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Fastsqlmodel showcase<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;text-align: center&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
        A super stylish home page
    <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Really interesting content, full of buzzwords like AI and MACHINE LEARNING!
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% if books %}
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        {% for book in books %}
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&quot;{{book.id}}&quot;</span><span class="p">&gt;</span>Title: {{book.title}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% endif %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>At this point, if you navigate <code>localhost:8000</code>, you won't see anything has changed - that's because our database is empty. But if the database <em>did</em> have books in it, then in the <code>get</code> request the <code>books = session.exec(select(Book)).all()</code> would contain a list of <code>book</code> items, and so our Jinja template <code>index.html</code> would get passed a non-empty list</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
    A super stylish home page
<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    Really interesting content, full of buzzwords like AI and MACHINE LEARNING!
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

{% if books %}
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>

        {% for book in books %}
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&quot;{{book.id}}&quot;</span><span class="p">&gt;</span>Title: {{book.title}}, Author: {{book.author}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
{% endif %}
</pre></div>
<p>There are many ways to add data into our database. You could use <a href="https://sqlitebrowser.org/">SQLite Browser</a> to open the <code>database.db</code> file or any other database browser. Instead, we will add a <code>POST</code> route so that we can add in data from the browser.</p>
<p>Add the following code the <code>main.py</code>, just below the <code>@app.get('/')</code> route.</p>
<div class="highlight"><pre><span></span><span class="c1"># new</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/book&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_book</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">),</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">book</span><span class="p">:</span> <span class="n">BookCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BookRead</span><span class="p">:</span>
    <span class="n">db_book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">db_book</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">db_book</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_book</span>
<span class="c1"># -------</span>
</pre></div>
<p>We've added in two new models here, <code>BookCreate</code> and <code>BookRead</code>. Add them to the <code>models.py</code> file.</p>
<div class="highlight"><pre><span></span><span class="c1"># app/models.py</span>
<span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">SQLModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>


<span class="k">class</span> <span class="nc">BookBase</span><span class="p">(</span><span class="n">SQLModel</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">BookBase</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># new ---</span>
<span class="k">class</span> <span class="nc">BookCreate</span><span class="p">(</span><span class="n">BookBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">BookRead</span><span class="p">(</span><span class="n">BookBase</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
<span class="c1"># ------</span>
</pre></div>
<p>Now, navigate to <code>localhost:8000/docs</code> in your browser, and you should see the <code>POST</code> method right there:</p>
<p><img src="/nlp-otherwise/images/copied_from_nb/../images/screenshot_2.png" alt="You should see this in the docs"></p>
<p>Click on the post request and add a few books in. These will now be saved into the database.
 Thanks to the way we wrote the <code>index.html</code> file, if you navigate again to the home page (<code>localost:8000</code>), you should see the books that you just added.
Since we didn't implement <code>@app.delete</code> or <code>@app.patch</code> methods, we can't delete or update the entries. To start afresh, you can just delete the <code>database.db</code> file and re-add the books.</p>
<h2 id="Adding-a-description-column-with-Alembic">Adding a <code>description</code> column with Alembic<a class="anchor-link" href="#Adding-a-description-column-with-Alembic"> </a></h2><p>Now let's say that we want to add a <code>description</code> field to the book items. We could just delete the <code>database.db</code> file, make the changes to the <code>Book</code> model, and restart the app. However, if we were in the situation where the database had a bunch of entries that you don't want to lose, then using migrations is the way to go. We'll be using <code>alembic</code>, see <a href="https://alembic.sqlalchemy.org/en/latest/">the documentation</a> for more information. We need to do a few changes to the setup since we are using <code>sqlmodel</code> and not <code>sqlalchemy</code>. <a href="https://testdriven.io/blog/fastapi-sqlmodel/#alembic">TestDriven.io</a> has a nice tutorial showing how to do this, so we'll follow that here (although we won't be using the <code>async</code> version)
Start by going to the terminal, from root directory of the project, run</p>
<div class="highlight"><pre><span></span>alembic init alembic
</pre></div>
<p>This will make a directory called <code>alembic</code> with some files that we need to modify. The project structure should now look like this</p>

<pre><code>.
|-- alembic
|   |-- README
|   |-- env.py
|   |-- script.py.mako
|   `-- versions
|-- alembic.ini
|-- app
|   |-- __init__.py
|   |-- database.py
|   |-- main.py
|   |-- models.py
|   |-- settings.py
|   `-- static/
|   `-- templates
|       `-- index.html
|-- database.db
`-- requirements.txt</code></pre>
<p>In the <code>script.py.mako</code> file, we need to <code>import sqlmodel</code>:</p>

<pre><code># alembic/script.py.mako
# code above ommited

from alembic import op
import sqlalchemy as sa
# new ---
import sqlmodel
# -------
${imports if imports else ""}

# code below ommited</code></pre>
<p>and finally in the <code>alembic/env.py</code> add the following imports,</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging.config</span> <span class="kn">import</span> <span class="n">fileConfig</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">engine_from_config</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">pool</span>

<span class="kn">from</span> <span class="nn">alembic</span> <span class="kn">import</span> <span class="n">context</span>

<span class="c1"># new ---</span>
<span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">SQLModel</span>
<span class="kn">from</span> <span class="nn">app.settings</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">app.models</span> <span class="kn">import</span> <span class="n">Book</span>
<span class="c1"># -------</span>

<span class="c1"># this is the Alembic Config object, which provides</span>
<span class="c1"># access to the values within the .ini file in use.</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">config</span>
<span class="c1"># new ---</span>
<span class="n">config</span><span class="o">.</span><span class="n">set_main_option</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.url&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">database_url</span><span class="p">)</span>
<span class="c1"># -------</span>
<span class="c1"># Interpret the config file for Python logging.</span>
<span class="c1"># This line sets up loggers basically.</span>
<span class="n">fileConfig</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">config_file_name</span><span class="p">)</span>

<span class="c1"># add your model&#39;s MetaData object here</span>
<span class="c1"># for &#39;autogenerate&#39; support</span>

<span class="c1"># target_metadata = mymodel.Base.metadata</span>
<span class="n">target_metadata</span> <span class="o">=</span> <span class="n">SQLModel</span><span class="o">.</span><span class="n">metadata</span>

<span class="c1"># ---- code below omitted ---</span>
</pre></div>
<p>All we've done here is import the <code>SQLModel</code> from <code>sqlmodel</code>, which holds all the metadata about our database (after also importing our <code>Book</code> model), then we've grabbed the <code>database_url</code> from the settings file.</p>
<p>Now delete the <code>database.db</code> file, and then generate the first alembic migration with <code>alembic revision -autogenerate -m "Add book table"</code> to verify that everything sets up properly. If successful, you will find a new file in the <code>alembic/revisions</code> directory which looks something like this (the revision ID might be different):</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Add book table</span>

<span class="sd">Revision ID: 7071875a0907</span>
<span class="sd">Revises:</span>
<span class="sd">Create Date: 2021-09-12 22:16:26.595677</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">alembic</span> <span class="kn">import</span> <span class="n">op</span>
<span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="c1"># new ---</span>
<span class="kn">import</span> <span class="nn">sqlmodel</span>
<span class="c1"># -------</span>


<span class="c1"># revision identifiers, used by Alembic.</span>
<span class="n">revision</span> <span class="o">=</span> <span class="s1">&#39;7071875a0907&#39;</span>
<span class="n">down_revision</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">branch_labels</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">depends_on</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">upgrade</span><span class="p">():</span>
    <span class="c1"># ### commands auto generated by Alembic - please adjust! ###</span>
    <span class="n">op</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">,</span>
    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">sqlmodel</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">sqltypes</span><span class="o">.</span><span class="n">AutoString</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">sqlmodel</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">sqltypes</span><span class="o">.</span><span class="n">AutoString</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">sa</span><span class="o">.</span><span class="n">PrimaryKeyConstraint</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_author&#39;</span><span class="p">),</span> <span class="s1">&#39;book&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">],</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_id&#39;</span><span class="p">),</span> <span class="s1">&#39;book&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_title&#39;</span><span class="p">),</span> <span class="s1">&#39;book&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># ### end Alembic commands ###</span>


<span class="k">def</span> <span class="nf">downgrade</span><span class="p">():</span>
    <span class="c1"># ### commands auto generated by Alembic - please adjust! ###</span>
    <span class="n">op</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_title&#39;</span><span class="p">),</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;book&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_id&#39;</span><span class="p">),</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;book&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_author&#39;</span><span class="p">),</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;book&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">drop_table</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">)</span>
    <span class="c1"># ### end Alembic commands ###</span>
</pre></div>
<p>Apply the migration (which just creates the table in the database) with <code>alembic upgrade head</code>.</p>
<p>Now to add a new column to the <code>book</code> table in the database, add the following to the <code>Book</code> model in <code>app/models.py</code>,</p>
<div class="highlight"><pre><span></span><span class="o">...</span>
<span class="k">class</span> <span class="nc">BookBase</span><span class="p">(</span><span class="n">SQLModel</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="c1"># new ---</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="c1"># -------</span>
<span class="o">...</span>
</pre></div>
<p>and then generate another migration file with</p>
<div class="highlight"><pre><span></span>alembic revision --autogenerate -m <span class="s2">&quot;Add description column&quot;</span>
</pre></div>
<p>This gives us the following migration file,</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Add description column</span>

<span class="sd">Revision ID: 0b26b04f3af4</span>
<span class="sd">Revises: 7071875a0907</span>
<span class="sd">Create Date: 2021-09-12 22:55:29.481379</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">alembic</span> <span class="kn">import</span> <span class="n">op</span>
<span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="kn">import</span> <span class="nn">sqlmodel</span>

<span class="c1"># revision identifiers, used by Alembic.</span>
<span class="n">revision</span> <span class="o">=</span> <span class="s1">&#39;0b26b04f3af4&#39;</span>
<span class="n">down_revision</span> <span class="o">=</span> <span class="s1">&#39;7071875a0907&#39;</span>
<span class="n">branch_labels</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">depends_on</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">upgrade</span><span class="p">():</span>
    <span class="c1"># ### commands auto generated by Alembic - please adjust! ###</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">sqlmodel</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">sqltypes</span><span class="o">.</span><span class="n">AutoString</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">op</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_description&#39;</span><span class="p">),</span> <span class="s1">&#39;book&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># ### end Alembic commands ###</span>


<span class="k">def</span> <span class="nf">downgrade</span><span class="p">():</span>
    <span class="c1"># ### commands auto generated by Alembic - please adjust! ###</span>
    <span class="n">op</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;ix_book_description&#39;</span><span class="p">),</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;book&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">drop_column</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">)</span>
    <span class="c1"># ### end Alembic commands ###</span>
</pre></div>
<p>Apply the migration with <code>alembic upgrade head</code>.</p>
<h2 id="Update-Jinja-template">Update Jinja template<a class="anchor-link" href="#Update-Jinja-template"> </a></h2><p>Now we are going to modify the jinja template in <code>index.html</code> to use the new <code>description</code> column. While we're at it, lets add some more styling to the page with a header and a footer. For this, we'll create a new file <code>templates/layout.html</code>. In there we will put all the things from <code>index.html</code> that should go on every page (if there were more pages).</p>
<div class="highlight"><pre><span></span>{% raw %}
<span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en-us&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;A website showcasing fastapi and sqlmodel&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;idjotherwise&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Fastsqlmodel showcase<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/static/css/styling.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span> <span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content-wrapper&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;font-semi-bold&quot;</span><span class="p">&gt;</span>
                          Book list
                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                {% block content %}
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
                                THIS PAGE HAS NO CONTENT
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                {% endblock %}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;footer&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;footer links&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;glyphicon glyphicon-cog icon-muted&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;</span><span class="nt">a</span>
                            <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://github.com/idjotherwise&quot;</span>
                            <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span><span class="p">&gt;</span>Github<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;glyphicon glyphicon-globe icon-muted&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://twitter.com&quot;</span>
                                                                               <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span><span class="p">&gt;</span>Twitter<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
{% endraw %}
</pre></div>
<p>Now our <code>app/templates/index.html</code> will extend the <code>app/templates/layout.html</code> file:</p>
<div class="highlight"><pre><span></span>{% raw %}
{% extends &quot;layout.html&quot; %}
{% block content %}

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
        A super stylish home page
    <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Really interesting content, full of buzzwords like AI and MACHINE LEARNING!
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% if books %}
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;text-align: left&quot;</span><span class="p">&gt;</span>
        {% for book in books %}
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="s">&quot;{{book.id}}&quot;</span><span class="p">&gt;</span>Title: {{book.title}}, Author: {{book.author}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="c">&lt;!-- New description --&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{book.description}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% endif %}

{% endblock %}
{% endraw %}
</pre></div>
<p>Finally we will add some simple styling in the file <code>app/static/css/styling.css</code>. You can also just put in your own style file here if you like.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="p">@</span><span class="k">import</span> <span class="nt">url</span><span class="o">(//</span><span class="nt">fonts</span><span class="p">.</span><span class="nc">googleapis</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">css</span><span class="o">?</span><span class="nt">family</span><span class="o">=</span><span class="nt">Open</span><span class="o">+</span><span class="nt">Sans</span><span class="p">:</span><span class="nd">300</span><span class="o">,</span><span class="nt">400</span><span class="o">,</span><span class="nt">600</span><span class="o">,</span><span class="nt">700</span><span class="o">)</span><span class="p">;</span>

<span class="nt">body</span> <span class="p">{</span>
    <span class="k">font-family</span><span class="p">:</span> <span class="s2">&quot;Open Sans&quot;</span><span class="p">,</span> <span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">,</span> <span class="n">Helvetica</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
    <span class="k">font-weight</span><span class="p">:</span> <span class="mi">300</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">black</span><span class="p">;</span>
    <span class="k">background</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="k">padding-left</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding-right</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span><span class="o">,</span>
<span class="nt">h2</span><span class="o">,</span>
<span class="nt">h3</span><span class="o">,</span>
<span class="nt">h4</span><span class="o">,</span>
<span class="nt">h5</span><span class="o">,</span>
<span class="nt">h6</span> <span class="p">{</span>
    <span class="k">font-family</span><span class="p">:</span> <span class="s2">&quot;Open Sans&quot;</span><span class="p">,</span> <span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">,</span> <span class="n">Helvetica</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
    <span class="k">font-weight</span><span class="p">:</span> <span class="mi">300</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
    <span class="k">font-weight</span><span class="p">:</span> <span class="mi">300</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">{</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">25</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>


<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">.</span><span class="nc">content</span> <span class="nt">h1</span> <span class="nt">span</span> <span class="p">{</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">font-size</span><span class="p">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">left</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That's enough front-end stuff for now, next up we'll work on adding some tests (with <code>pytest</code>) and then deploying the initial app to Heroku.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Testing-with-Pytest">Testing with Pytest<a class="anchor-link" href="#Testing-with-Pytest"> </a></h2><h2 id="Deploy-to-Heroku">Deploy to Heroku<a class="anchor-link" href="#Deploy-to-Heroku"> </a></h2><p>Add a file called <code>Procfile</code> in the root of the directory, and add the following to it:</p>

<pre><code>web: gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker
release: alembic upgrade head</code></pre>
<p>When we push our code to Heroku, it will detect the presence of this <code>Procfile</code> and run the <code>web</code> command as the main process and the <code>release</code> command in the release phase of the app.</p>
<h2 id="Adding-other-endpoints">Adding other endpoints<a class="anchor-link" href="#Adding-other-endpoints"> </a></h2>
</div>
</div>
</div>
</div>
 

